!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){this.genomeLength=616,this.populationSize=200,this.populationName="alice-0.0.2"};e.default=new r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default='importScripts(\'lib/tank.js\');\n\nvar TankAI=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BrainFieldType=void 0,function(t){t[t.ConnectionWeight=0]="ConnectionWeight",t[t.Bias=1]="Bias",t[t.ActivationType=2]="ActivationType"}(e.BrainFieldType||(e.BrainFieldType={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=function(){function t(){this._collisionCounter=0}return t.prototype.init=function(t,e){this._brain=new i.default,this._brain.createLayers([6,7,6,4]),this._brain.restoreSnapshot(e.initData.braindump)},t.prototype.loop=function(t,e){var n,i;this._collisionCounter>0&&this._collisionCounter--;var r=null!==t.radar.wallDistance?t.radar.wallDistance:300;r=r/150-1;var o,a=300,u=0;if(t.radar.enemy){for(n=t.radar.enemy.x-t.x,i=t.radar.enemy.y-t.y,a=Math.sqrt(n*n+i*i),u=180/Math.PI*Math.atan2(t.radar.enemy.y-t.y,t.radar.enemy.x-t.x),u-=t.angle;u>180;)u-=360;for(;u<-180;)u+=360;u/=8}a=a/150-1,(t.collisions.ally||t.collisions.enemy||t.collisions.wall)&&(this._collisionCounter=30),o=[r,a,u,this._collisionCounter>0?1:0,t.radar.targetingAlarm?1:0,t.boost/200-1];var s=this._brain.process(o);e.THROTTLE=s[0],e.TURN=s[1],e.SHOOT=s[2]/2+.5,e.BOOST=s[3]>0?1:0},t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(0),o=n(6),a=function(){function t(){this._network=[],this._connections=[],this._nodes=[],this.serializer=new o.default}return t.prototype.createLayers=function(t){var e,n,r;for(e=0;e<t.length;e++)for(this._network[e]=[],n=0;n<t[e];n++)this._network[e][n]=new i.default,this._nodes.push(this._network[e][n]);for(e=1;e<this._network.length;e++)for(n=0;n<this._network[e].length;n++)for(r=0;r<this._network[e-1].length;r++)this._network[e][n].setInput(r,this._network[e-1][r].getOutput(n)),this._connections.push(this._network[e-1][r].getOutput(n))},t.prototype.randomize=function(){for(var t=0;t<this._network.length;t++)for(var e=0;e<this._network[t].length;e++)this._network[t][e].randomize()},t.prototype.getNode=function(t,e){if(!this._network[t]||!this._network[t][e])throw new Error("Node not found ("+t+":"+e+")");return this._network[t][e]},Object.defineProperty(t.prototype,"layerCount",{get:function(){return this._network.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connectionCount",{get:function(){return this._connections.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nodeCount",{get:function(){return this._nodes.length},enumerable:!1,configurable:!0}),t.prototype.getLayerSize=function(t){return this._network[t]?this._network[t].length:0},t.prototype.process=function(t){var e,n=[];for(e=0;e<t.length;e++)this.getNode(0,e).getInput(0).input=t[e];for(e=0;e<this._nodes.length;e++)this._nodes[e].process();var i=this._network[this._network.length-1];for(e=0;e<i.length;e++)n.push(i[e].getOutput(0).process());return n},t.prototype.createSnapshot=function(){this.serializer.allocate(2*this._nodes.length+this._connections.length);for(var t=0,e=0,n=0,i=0;i<this._network.length;i++)for(e=0;e<this._network[i].length;e++)if(this.serializer.write(this._network[i][e].bias,t++,r.BrainFieldType.Bias),this.serializer.write(this._network[i][e].activationType,t++,r.BrainFieldType.ActivationType),i!=this._network.length-1)for(n=0;n<this._network[i][e].outputCount;n++)this.serializer.write(this._network[i][e].getOutput(n).weight,t++,r.BrainFieldType.ConnectionWeight);return this.serializer.serialize()},t.prototype.restoreSnapshot=function(t){this.serializer.deserialize(t);for(var e=0,n=0,i=0,o=0;o<this._network.length;o++)for(n=0;n<this._network[o].length;n++)if(this._network[o][n].bias=this.serializer.read(e++,r.BrainFieldType.Bias),this._network[o][n].activationType=this.serializer.read(e++,r.BrainFieldType.ActivationType),o!=this._network.length-1)for(i=0;i<this._network[o][n].outputCount;i++)this._network[o][n].getOutput(i).weight=this.serializer.read(e++,r.BrainFieldType.ConnectionWeight)},t}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(4),r=n(5),o=function(){function t(){this._inputs=[],this._outputs=[],this._value=0,this._activation=new r.default(r.ActivationType.Linear),this.bias=0,this._inputCount=0,this._outputCount=0}return Object.defineProperty(t.prototype,"inputCount",{get:function(){return this._inputCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"outputCount",{get:function(){return this._outputCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activationType",{get:function(){return this._activation.type},set:function(t){this._activation=new r.default(t)},enumerable:!1,configurable:!0}),t.prototype.getInput=function(t){return this._inputs[t]||(this._inputs[t]=new i.default),this._inputCount=Math.max(this._inputCount,t+1),this._inputs[t]},t.prototype.setInput=function(t,e){this._inputs[t]=e},t.prototype.getOutput=function(t){return this._outputs[t]||(this._outputs[t]=new i.default,this._outputs[t].input=this._value),this._outputCount=Math.max(this._outputCount,t+1),this._outputs[t]},t.prototype.configure=function(t,e,n,i){var r;for(r=0;r<t.length;r++)this.getInput(r).weight=t[r];for(r=0;r<e.length;r++)this.getOutput(r).weight=e[r];this.bias=n,this.activationType=i},t.prototype.randomize=function(){for(var t=0,e=this._inputs;t<e.length;t++){e[t].weight=2*Math.random()-1}for(var n=0,i=this._outputs;n<i.length;n++){i[n].weight=2*Math.random()-1}this.bias=2*Math.random()-1;var o=Object.keys(r.ActivationType).map((function(t){return Number.parseInt(t)})).filter((function(t){return!Number.isNaN(t)}));this.activationType=o[Math.floor(Math.random()*o.length)]},t.prototype.process=function(){for(var t=0,e=0,n=this._inputs;e<n.length;e++){t+=n[e].process()}t+=this.bias,t=this._activation.process(t),this._value=t;for(var i=0,r=this._outputs;i<r.length;i++){r[i].input=t}},t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.input=0,this.weight=1}return t.prototype.process=function(){return this.input*this.weight},t}();e.default=i},function(t,e,n){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.ActivationType=void 0,function(t){t[t.Linear=0]="Linear",t[t.BinaryStep=1]="BinaryStep",t[t.Sigmoid=2]="Sigmoid",t[t.TanH=3]="TanH",t[t.ReLU=4]="ReLU",t[t.SoftPlus=5]="SoftPlus",t[t.LeakyReLU=6]="LeakyReLU",t[t.Gaussian=7]="Gaussian"}(i=e.ActivationType||(e.ActivationType={}));var r=function(){function t(t){this._type=i.Linear,this._type=t}return Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),t.prototype.process=function(t){switch(this._type){case i.Linear:return t;case i.BinaryStep:return t<0?0:1;case i.Sigmoid:return t>100?1:t<-100?0:1/(1+Math.exp(-t));case i.TanH:return t>100?1:t<-100?-1:(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t));case i.ReLU:return t<0?0:t;case i.SoftPlus:return t>100?t:Math.log(1+Math.exp(t));case i.LeakyReLU:return t>100?t:t<0?.1*t:t;case i.Gaussian:return t>100||t<-100?0:Math.exp(-t*t);default:throw new Error("Unsupported activation type: "+this._type)}},t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=function(){function t(){}return t.prototype.allocate=function(t){this._data=new Uint32Array(t)},t.prototype.writeRaw=function(t,e,n,i){if(isNaN(t))throw new Error("valid numeric value is erquired");if(n>=i)throw new Error("Incorrect scale ("+n+" - "+i+")");if(e>=this._data.length)throw new Error("Index "+e+" out of range. Allocation: "+this._data.length);t=((t=Math.min(i,Math.max(n,t)))-n)/(i-n),t*=4294967295,t=Math.round(t),this._data[e]=t},t.prototype.readRaw=function(t,e,n){if(e>=n)throw new Error("Incorrect scale ("+e+" - "+n+")");var i=this._data[t];return i/=4294967295,i*=n-e,i+=e},t.prototype.write=function(t,e,n){switch(n){case i.BrainFieldType.ConnectionWeight:return this.writeRaw(t,e,-4,4);case i.BrainFieldType.Bias:return this.writeRaw(t,e,-1,1);case i.BrainFieldType.ActivationType:return this.writeRaw(Math.round(t),e,0,7);default:throw new Error("BrainFieldType("+n+") not supported")}},t.prototype.read=function(t,e){switch(e){case i.BrainFieldType.ConnectionWeight:return this.readRaw(t,-4,4);case i.BrainFieldType.Bias:return this.readRaw(t,-1,1);case i.BrainFieldType.ActivationType:return Math.round(this.readRaw(t,0,7));default:throw new Error("BrainFieldType("+e+") not supported")}},t.prototype.serialize=function(){if(!this._data)throw new Error("No data to serialize");return this._data.buffer},t.prototype.deserialize=function(t){this._data=new Uint32Array(t)},t}();e.default=r}]);\n\nconst ai = new TankAI.default();\n\ntank.init(function(settings, info) {\n  ai.init(settings, info)\n});\n\ntank.loop(function(state, control) {\n  ai.loop(state, control);\n});\n'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(8),i=n(3),o=n(0),a=function(){function t(){this._units=[],this._unitIndex=1,this._generation=1,this._bestScore=0,this._worstScore=0,this._diversity=100,this._scoreHistogram=[],this._lastCompleteTime=(new Date).getTime(),this._completeTimes=[],this._mutationProbability=.01}return Object.defineProperty(t.prototype,"scoreHistogram",{get:function(){return this._scoreHistogram},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diversity",{get:function(){return this._diversity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._units.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bestScore",{get:function(){return this._bestScore},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bestGenome",{get:function(){return this._bestGenome},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worstScore",{get:function(){return this._worstScore},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"generation",{get:function(){return this._generation},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"units",{get:function(){return this._units},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mutationProbability",{get:function(){return this._mutationProbability},set:function(t){this._mutationProbability=t},enumerable:!1,configurable:!0}),t.prototype.create=function(t){for(this._units=[],this._unitIndex=1,this._generation=1,this._bestScore=0,this._bestGenome=null,this._worstScore=0,this._diversity=100,this._scoreHistogram=[],this._lastCompleteTime=(new Date).getTime(),this._completeTimes=[];this.size<t;){for(var e=new Uint8Array(o.default.genomeLength),n=0;n<o.default.genomeLength;n++)e[n]=Math.round(255*Math.random());this._units.push(new r.default("tank-"+this._unitIndex++,new i.default(e.buffer)))}this.updateDiversity()},t.prototype.pickFitUnit=function(t){for(var e=Math.random(),n=0;n<t.length;n++)if(t[n].score>=e)return t[n];return t[t.length-1]},t.prototype.updateDiversity=function(){var t=this._units.map((function(t){return t.genome.hash})),e=t.filter((function(t,e,n){return n.indexOf(t)===e}));this._diversity=Math.round(1e4*e.length/t.length)/100},t.prototype.evolve=function(){var t,e=this._units;for(e=e.sort((function(t,e){return e.score-t.score})),this._bestScore=e[0].score,this._bestGenome=e[0].genome,this._worstScore=e[e.length-1].score,this._scoreHistogram=[],t=0;t<450;t+=5)this._scoreHistogram.push(e.filter((function(e){return e.score>=t&&e.score<t+5})).length);this._scoreHistogram.push(e.filter((function(t){return t.score>=450})).length);var n=e.reduce((function(t,e){return t+e.score}),0);for(e.forEach((function(t){return t.setScore(t.score/n)})),t=1;t<e.length;t++)e[t].setScore(e[t-1].score+e[t].score);e[e.length-1].setScore(1);for(var i=[];i.length<e.length;){var o=this.pickFitUnit(e),a=this.pickFitUnit(e),s=o.genome.crossover(a.genome);Math.random()>1-this._mutationProbability&&(console.log("mutate"),s=s.mutate()),i.push(new r.default("tank-"+this._unitIndex++,s))}this._units=i,this._generation++,this.updateDiversity()},t.prototype.pickFree=function(){for(var t=0;t<this._units.length;t++)if(!this._units[t].completed&&!this._units[t].inProgress)return this._units[t];return null},Object.defineProperty(t.prototype,"completed",{get:function(){return!this._units.find((function(t){return!t.completed}))},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{generation:this._generation,unitIndex:this._unitIndex,bestScore:this._bestScore,bestGenome:this._bestGenome?this._bestGenome.toJSON():null,worstScore:this._worstScore,scoreHistogram:this._scoreHistogram,units:this._units.map((function(t){return t.toJSON()}))}},t.prototype.save=function(t){localStorage.setItem(t+"-"+this._units.length,JSON.stringify(this.toJSON()))},t.prototype.load=function(t){var e=localStorage.getItem(t+"-"+this._units.length);if(e){var n=JSON.parse(e);this.restoreFromJSON(n)}},t.prototype.restoreFromJSON=function(t){this._generation=t.generation,this._unitIndex=t.unitIndex,this._bestScore=t.bestScore,this._worstScore=t.worstScore,this._scoreHistogram=t.scoreHistogram,t.bestGenome&&(this._bestGenome=i.default.fromJSON(t.bestGenome)),this._units=t.units.map((function(t){return r.default.fromJSON(t)})).map((function(t){return t.inProgress&&!t.completed&&t.reset(),t}))},t.prototype.notifyCompleted=function(){var t=(new Date).getTime();for(this._completeTimes.push(t-this._lastCompleteTime),this._lastCompleteTime=t;this._completeTimes.length>this._units.length;)this._completeTimes.shift()},t.prototype.getUnitProcessingRate=function(){var t=this._completeTimes.length;return 0==t?0:6e4/(this._completeTimes.reduce((function(t,e){return t+e}),0)/t)},t.prototype.reset=function(){var t=this.size;this.create(t)},t}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(e){this._data=e?new Uint8Array(e):new Uint8Array(0),this._hash=t.hash(this._data)}return Object.defineProperty(t.prototype,"data",{get:function(){return this._data.buffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hash",{get:function(){return this._hash},enumerable:!1,configurable:!0}),t.hash=function(t){return t.reduce((function(t,e){return(t=(t<<5)-t+Math.round(e/10))&t}),0)},t.prototype.crossover=function(e){var n=new Uint8Array(e.data);if(this._data.length!=n.length)throw new Error("Cannot crossover genomes with different lengths");for(var r=new Uint8Array(this._data.length),i=0;i<this._data.length;i++){var o=this._data[i],a=n[i],s=Math.round(255*Math.random()),u=o&s|a&~s;r[i]=u}return new t(r.buffer)},t.prototype.mutate=function(){var e=new Uint8Array(this._data.buffer.slice(0));return e[Math.floor(Math.random()*this._data.length)]=Math.round(255*Math.random()),new t(e.buffer)},t.prototype.toJSON=function(){return{data:Array.from(this._data)}},t.fromJSON=function(e){var n=new t;return n._data=new Uint8Array(e.data),n._hash=t.hash(n._data),n},t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){var n=this;this._domContainer=t,this._popupContainer=document.getElementById(e),this._domContainer.appendChild(this._popupContainer),this.closePopup();for(var r=this._popupContainer.getElementsByClassName("close-button"),i=0;i<r.length;i++)r[i].onclick=function(){return n.closePopup()}}return Object.defineProperty(t.prototype,"domContainer",{get:function(){return this._domContainer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"popupContainer",{get:function(){return this._popupContainer},enumerable:!1,configurable:!0}),t.prototype.showPopup=function(){this._popupContainer.style.display="block"},t.prototype.closePopup=function(){this._popupContainer.style.display="none"},t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(6),i=n(14);n(15),"#preview"==window.location.hash?new i.PreviewApp:new r.SimApp},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SimApp=void 0;var r=n(7),i=n(2),o=n(9),a=n(0),s=function(){function t(){var t=this;this._players=[],this._population=new i.default,this._population.create(a.default.populationSize),this._population.load(a.default.populationName),this._population.completed&&this.onPopulationCompleted(),this._populationHud=new o.default("summary",this._population);for(var e=0;e<this._populationHud.settingsPopup.concurrency;e++)this.createSimPlayer();this._populationHud.onChange((function(){for(;t._players.length>0;){var e=t._players.pop();e.releaseUnits(),e.stop(),e.destroy()}for(;t._players.length<t._populationHud.settingsPopup.concurrency;)t.createSimPlayer();t._players.forEach((function(e){e.timeLimit=t._populationHud.settingsPopup.battleDuration,e.simSpeed=t._populationHud.settingsPopup.simSpeed,e.trainingUnits=t._populationHud.settingsPopup.trainingUnits,e.dummyUnits=t._populationHud.settingsPopup.dummyUnits,e.dummyType=t._populationHud.settingsPopup.dummyType,e.renderer=t._populationHud.settingsPopup.renderer})),t._population.mutationProbability=t._populationHud.settingsPopup.mutation})),this._populationHud.importPopup.onLoad((function(e){for(t._population.restoreFromJSON(e);t._players.length>0;){var n=t._players.pop();n.releaseUnits(),n.stop(),n.destroy()}for(;t._players.length<t._populationHud.settingsPopup.concurrency;)t.createSimPlayer()}))}return t.prototype.createSimPlayer=function(){var t=this,e=document.getElementById("sim"),n=new r.default(e);n.timeLimit=this._populationHud.settingsPopup.battleDuration,n.simSpeed=this._populationHud.settingsPopup.simSpeed,n.trainingUnits=this._populationHud.settingsPopup.trainingUnits,n.dummyUnits=this._populationHud.settingsPopup.dummyUnits,n.dummyType=this._populationHud.settingsPopup.dummyType,n.renderer=this._populationHud.settingsPopup.renderer,n.create(),n.onFinish((function(){t._population.completed?(n.stop(),t.onPopulationCompleted()):n.start(t._population),t._population.save(a.default.populationName)})),n.start(this._population),this._players.push(n)},t.prototype.onPopulationCompleted=function(){var t;for(t=0;t<this._players.length;t++)this._players[t].stop();for(this._population.evolve(),t=0;t<this._players.length;t++)this._players[t].start(this._population)},t}();e.SimApp=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=function(){function t(t){this._isRunning=!1,this._onFinishCallbacks=[],this._units=[],this.timeLimit=6e4,this.simSpeed=2,this.trainingUnits=4,this.dummyUnits=1,this.dummyType="crawler",this.renderer="debug",this._rootContainer=t}return t.prototype.onFinish=function(t){this._onFinishCallbacks.push(t)},t.prototype.create=function(){this._domContainer=document.createElement("div"),this._domContainer.style.width="450px",this._domContainer.style.display="inline-block",this._rootContainer.appendChild(this._domContainer)},t.prototype.destroy=function(){this._domContainer&&this._domContainer.parentNode&&(this._domContainer.parentNode.removeChild(this._domContainer),this._domContainer=null)},t.prototype.stop=function(){for(;this._domContainer.firstChild;)this._domContainer.removeChild(this._domContainer.lastChild);this._simulation&&(this._simulation.stop(),this._simulation=null),this._renderer&&(this._renderer.stop(),this._renderer.dispose(),this._renderer=null),this._canvas=null,this._isRunning=!1,this._units=[]},t.prototype.releaseUnits=function(){for(;this._units.length;)this._units.pop().reset()},t.prototype.start=function(t){var e=this;this._isRunning&&this.stop(),t.pickFree()&&(this._canvas=document.createElement("canvas"),this._canvas.style.width="450px",this._canvas.style.height="300px",this._domContainer.appendChild(this._canvas),this._renderer=JsBattle.createRenderer(this.renderer),this._renderer.init(this._canvas),this._renderer.loadAssets((function(){var n,i;if(e._simulation=JsBattle.createSimulation(e._renderer),e._simulation.setSpeed(e.simSpeed),e._simulation.timeLimit=e.timeLimit,e._simulation.init(900,600),e._simulation.onFinish((function(){e._simulation.tankList.filter((function(t){return"dummy"!=t.name})).forEach((function(e){t.units.find((function(t){return t.name==e.name})).setScore(e.score),t.notifyCompleted()})),e._onFinishCallbacks.forEach((function(t){return t()}))})),t.pickFree()){var o,a={static:'importScripts("lib/tank.js");tank.init(function(n,r){}),tank.loop(function(n,r){});',crawler:'importScripts("lib/tank.js");var turnDirection,turnTimer;tank.init(function(n,r){n.SKIN="forest",turnDirection=Math.random()<.5?1:-1,turnTimer=Math.round(Math.randomRange(0,30))}),tank.loop(function(n,r){(n.collisions.wall||n.collisions.enemy||n.collisions.ally)&&(turnTimer=Math.round(Math.randomRange(20,50))),turnTimer>0?(turnTimer--,r.THROTTLE=0,r.TURN=turnDirection):(r.THROTTLE=1,r.TURN=0),n.radar.enemy&&(r.SHOOT=0)});',sniper:'importScripts("lib/tank.js");var power;tank.init(function(a,e){a.SKIN="forest",power=.9*Math.random()+.1}),tank.loop(function(a,e){if(a.radar.enemy){var r=Math.deg.atan2(a.radar.enemy.y-a.y,a.radar.enemy.x-a.x),n=Math.deg.normalize(r-(a.radar.angle+a.angle));e.RADAR_TURN=.2*n;var t=Math.deg.normalize(r-(a.gun.angle+a.angle));e.GUN_TURN=.2*t,Math.abs(t)<3&&(e.SHOOT=power),e.DEBUG="power="+power.toFixed(2)}else e.RADAR_TURN=1});',predator:'importScripts("lib/tank.js");var turnTime;function shootEnemy(e,a){let n=e.radar.enemy;if(!n)return;let t=Math.distance(e.x,e.y,n.x,n.y)/4,r=n.x+t*n.speed*Math.cos(Math.deg2rad(n.angle)),l=n.y+t*n.speed*Math.sin(Math.deg2rad(n.angle)),i=Math.deg.atan2(l-e.y,r-e.x),d=Math.deg.normalize(i-e.angle),m=Math.deg.normalize(d-e.gun.angle);a.GUN_TURN=.3*m,Math.abs(m)<1&&(a.SHOOT=1)}function scanEnemy(e,a){if(e.radar.enemy){let n=Math.deg.atan2(e.radar.enemy.y-e.y,e.radar.enemy.x-e.x),t=Math.deg.normalize(n-e.angle),r=Math.deg.normalize(t-e.radar.angle);a.RADAR_TURN=r}else a.RADAR_TURN=1}function followEnemy(e,a){if(!e.radar.enemy)return;let n=Math.deg.atan2(e.radar.enemy.y-e.y,e.radar.enemy.x-e.x),t=Math.deg.normalize(n-e.angle);a.TURN=.5*t;let r=Math.distance(e.x,e.y,e.radar.enemy.x,e.radar.enemy.y)-150;a.THROTTLE=r/100}function exploreBattlefiield(e,a){e.radar.enemy?a.THROTTLE=0:(e.collisions.wall||turnTime>0||e.radar.enemy?a.THROTTLE=0:a.THROTTLE=1,e.collisions.wall&&(turnTime=10),turnTime>0?(a.TURN=1,turnTime--):a.TURN=0)}tank.init(function(e,a){turnTime=0}),tank.loop(function(e,a){shootEnemy(e,a),scanEnemy(e,a),followEnemy(e,a),exploreBattlefiield(e,a)});',kamikaze:'importScripts("lib/tank.js");var turnDirection,turnTimer,direction,backTimer,boostTimer;tank.init(function(r,i){r.SKIN="forest",turnDirection=Math.random()<.5?1:-1,turnTimer=Math.round(Math.randomRange(0,30)),direction=1,backTimer=0}),tank.loop(function(r,i){if((r.collisions.enemy||r.collisions.ally)&&(backTimer=12,boostTimer=40),backTimer>0?(backTimer--,direction=-1):direction=1,boostTimer>0?(boostTimer--,i.BOOST=1):i.BOOST=0,i.THROTTLE=direction,r.radar.enemy){var e=Math.deg.atan2(r.radar.enemy.y-r.y,r.radar.enemy.x-r.x),n=Math.deg.normalize(e-(r.radar.angle+r.angle));i.RADAR_TURN=.2*n;var a=Math.deg.normalize(e-r.angle);i.TURN=.2*a}else i.RADAR_TURN=1,r.collisions.wall&&(turnTimer=Math.round(Math.randomRange(20,50))),turnTimer>0?(turnTimer--,i.THROTTLE=0,i.TURN=turnDirection):(i.THROTTLE=direction,i.TURN=0);i.DEBUG={boost:r.boost},i.SHOOT=r.radar.enemy?.3:0});',ttate10:'var ttate10Tank=function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";importScripts("lib/tank.js");var r,i,a,o,u,s=n(1),h=n(4),l=n(5),c=n(9),y=null;tank.init(function(t,e){u=e.id,(t=t||{}).SKIN=function(){var t=Array.prototype.slice.call(arguments),e=t.shift();return t.reverse().map(function(t,n){return String.fromCharCode(t-e-38-n)}).join("")}(26,180,176,166)+532..toString(36).toLowerCase()+function(){var t=Array.prototype.slice.call(arguments),e=t.shift();return t.reverse().map(function(t,n){return String.fromCharCode(t-e-36-n)}).join("")}(7,159),r=new s,i=new h,a=new l(r),o=new c}),tank.loop(function(t,e){y&&Math.distance(t.x,t.y,y.x,y.y),r.loop(t);var n=r.enemies.findClosest();i.setEnemy(n),i.setEnemyCount(r.enemies.count),i.update(t.x,t.y,t.angle+t.radar.angle,t.collisions.enemy),e.RADAR_TURN=i.turnOutput,t.collisions.wall?a.setEnemy(null):a.setEnemy(n),a.update(t),e.THROTTLE=a.throttleOutput,e.TURN=a.turnOutput,e.BOOST=a.boostOutput,o.setEnemy(n),o.setAllies(r.allies.all),o.update(t),e.GUN_TURN=o.turnOutput,e.SHOOT=o.shootOutput,e.OUTBOX=[{me:{id:u,x:t.x,y:t.y,angle:t.y,energy:t.energy,speed:0},enemy:t.radar.enemy?{id:t.radar.enemy.id,x:t.radar.enemy.x,y:t.radar.enemy.y,angle:t.radar.enemy.angle,energy:t.radar.enemy.energy,speed:t.radar.enemy.speed}:null,bullets:t.radar.bullets?t.radar.bullets.map(function(t){return{id:t.id,x:t.x,y:t.y,angle:t.angle,speed:t.speed,damage:t.damage}}):[]}],y=t,e.DEBUG=430..toString(36).toLowerCase()+16..toString(36).toLowerCase().split("").map(function(t){return String.fromCharCode(t.charCodeAt()+-71)}).join("")+26..toString(36).toLowerCase().split("").map(function(t){return String.fromCharCode(t.charCodeAt()+-39)}).join("")+function(){var t=Array.prototype.slice.call(arguments),e=t.shift();return t.reverse().map(function(t,n){return String.fromCharCode(t-e-5-n)}).join("")}(59,178,180,174,161)+16..toString(36).toLowerCase().split("").map(function(t){return String.fromCharCode(t.charCodeAt()+-71)}).join("")+10..toString(36).toLowerCase().split("").map(function(t){return String.fromCharCode(t.charCodeAt()+-39)}).join("")+916..toString(36).toLowerCase().split("").map(function(t){return String.fromCharCode(t.charCodeAt()+-71)}).join("")+31..toString(36).toLowerCase()+function(){var t=Array.prototype.slice.call(arguments),e=t.shift();return t.reverse().map(function(t,n){return String.fromCharCode(t-e-28-n)}).join("")}(43,172)+46680215..toString(36).toLowerCase()+16..toString(36).toLowerCase().split("").map(function(t){return String.fromCharCode(t.charCodeAt()+-71)}).join("")+1..toString(36).toLowerCase()+30..toString(36).toLowerCase().split("").map(function(t){return String.fromCharCode(t.charCodeAt()+-71)}).join("")+2..toString(36).toLowerCase()+function(){var t=Array.prototype.slice.call(arguments),e=t.shift();return t.reverse().map(function(t,n){return String.fromCharCode(t-e-4-n)}).join("")}(50,100)+(0).toString(36).toLowerCase()})},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(2),o=n(3);t.exports=function(){function t(){r(this,t),this._bulletMemory=new o({lifetime:40,force:4}),this._tankMemory=new a({lifetime:40,force:2}),this._allyMemory=new a({lifetime:40,force:2}),this._wallN=void 0,this._wallS=void 0,this._wallW=void 0,this._wallE=void 0,this._debug={}}return i(t,[{key:"loop",value:function(t){this._bulletMemory.predict(),this._tankMemory.predict(),this._allyMemory.predict();var e,n;for(e=0;e<t.radio.inbox.length;e++)n=t.radio.inbox[e],this._bulletMemory.add(n.bullets),n.enemy&&this._tankMemory.add(n.enemy),this._allyMemory.add(n.me);this._bulletMemory.add(t.radar.bullets),t.radar.enemy&&this._tankMemory.add(t.radar.enemy);var r=Math.deg.normalize(t.angle+t.radar.angle);t.radar.wallDistance&&r<-85&&r>-95&&(this._wallN=t.y-t.radar.wallDistance),t.radar.wallDistance&&r>85&&r<95&&(this._wallS=t.y+t.radar.wallDistance),t.radar.wallDistance&&r>-5&&r<5&&(this._wallE=t.x+t.radar.wallDistance),t.radar.wallDistance&&(r>175||r<-175)&&(this._wallW=t.x-t.radar.wallDistance)}},{key:"getForceVector",value:function(t,e){var n=this._tankMemory.getForceVector(t,e),r=this._allyMemory.getForceVector(t,e),i=this._bulletMemory.getForceVector(t,e),a=this._getWallForceVector(t,e),o=n.x+r.x+i.x+a.x,u=n.y+r.y+i.y+a.y,s=n.value+r.value+i.value+a.value;return this._debug.tankForce=1e6*n.value,this._debug.bulletForce=1e6*i.value,this._debug.wallForce=1e6*a.value,{x:o,y:u,r:Math.distance(0,0,o,u),value:s}}},{key:"_getWallForceVector",value:function(t,e){var n,r=0,i=0,a=0;return void 0!==this._wallN&&(n=(n=Math.abs(e-this._wallN))?1/(n*n*n):1,a+=n*=100,i+=n),void 0!==this._wallS&&(n=(n=Math.abs(this._wallS-e))?1/(n*n*n):1,a+=n*=100,i-=n),void 0!==this._wallE&&(n=(n=Math.abs(t-this._wallE))?1/(n*n*n):1,a+=n*=100,r-=n,n),void 0!==this._wallW&&(n=(n=Math.abs(this._wallW-t))?1/(n*n*n):1,a+=n*=100,r+=n,n),{x:r,y:i,r:Math.distance(0,0,r,i),value:a}}},{key:"debug",get:function(){return this._debug}},{key:"bullets",get:function(){return this._bulletMemory}},{key:"enemies",get:function(){return this._tankMemory}},{key:"allies",get:function(){return this._allyMemory}}]),t}()},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t.exports=function(){function t(e){n(this,t),e||(e={}),this._map=[],this._permanentMap=[],this._count=0,this._lifetime=e.lifetime?e.lifetime:30,this._force=e.force?e.force:1}return r(t,[{key:"findClosestPermanent",value:function(t,e){return this._findClosest(t,e,this._permanentMap)}},{key:"findClosest",value:function(t,e){return this._findClosest(t,e,this._map)}},{key:"_findClosest",value:function(t,e,n){var r,i,a,o=null;for(i in n)if(a=n[i]){var u=Math.distance(t,e,a.x,a.y);(!o||r>u)&&(r=u,o=a)}return o}},{key:"predict",value:function(){var t,e,n;this._count=0;for(t in this._map)if(n=this._map[t])if(n.age>this._lifetime)this._map[t]=null;else if(0==n.age?n.radarTime++:n.radarTime=0,n.age++,n.x+=n.vx,n.y+=n.vy,this._count++,void 0!==n.energy){for(;n.energyDropHistory.length>100;)n.energyDropHistory.shift();for(n.energyDropSum=0,e=0;e<n.energyDropHistory.length;e++)n.energyDropSum+=n.energyDropHistory[e];n.energyDropRate=n.energyDropSum/n.energyDropHistory.length}}},{key:"add",value:function(t){if(!Array.isArray(t))return this._addSingle(t);var e,n;for(e=0;e<t.length;e++)n=t[e],this._addSingle(n)}},{key:"getForceVector",value:function(t,e){var n,r,i={x:0,y:0,r:0,value:0};for(n in this._map)(r=this._map[n])&&this._getObjForceVector(r,i,t,e);return i.r=Math.distance(0,0,i.x,i.y),i}},{key:"_getObjForceVector",value:function(t,e,n,r){var t,i,a,o;i=Math.distance(n,r,t.x,t.y),a=(n-t.x)/i,o=(r-t.y)/i,i=i?1/(i*i):1,a*=i*=this._force,o*=i,e.x+=a,e.y+=o,e.value+=i}},{key:"_addSingle",value:function(t){if(t.age=0,t.radarTime=0,t.vx=t.speed*Math.cos(t.angle*(Math.PI/180)),t.vy=t.speed*Math.sin(t.angle*(Math.PI/180)),this._permanentMap[t.id]&&(t.radarTime=this._permanentMap[t.id].radarTime),void 0!==t.energy&&(t.energyDropSum=0,t.energyDropRate=void 0,t.energyDropHistory=[]),void 0!==t.energy&&this._permanentMap[t.id]&&this._permanentMap[t.id].energy){var e=(t.energy-this._permanentMap[t.id].energy)/this._permanentMap[t.id].age;t.energyDropHistory=this._permanentMap[t.id].energyDropHistory,t.energyDropSum=this._permanentMap[t.id].energyDropSum,t.energyDropRate=this._permanentMap[t.id].energyDropRate,t.energyDropHistory.push(e)}this._map[t.id]=t,this._permanentMap[t.id]=t}},{key:"count",get:function(){return this._count}},{key:"all",get:function(){return this._map}}]),t}()},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(2);t.exports=function(t){function e(t){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return a(e,u),o(e,[{key:"_getObjForceVector",value:function(t,e,n,r){var i=Math.tan(t.angle*(Math.PI/180)),a=t.y-i*t.x,o=i?-1/i:0x3a052cf8639b6a,u=r-o*n,s=i-o!=0?(u-a)/(i-o):NaN,h=i*s+a,l=Math.distance(n,r,s,h),c=(n-s)/l,y=(r-h)/l,_=Math.distance(n,r,t.x,t.y);void 0!==t.lastDistance?t.distanceSpeed=_-t.lastDistance:t.distanceSpeed=0,t.lastDistance=_,t.distanceSpeed>0&&_>100||(l=l?1/(_*_):1,l*=this._force,c*=l*=1+.5*t.damage/13,y*=l,isNaN(c)||isNaN(y)||isNaN(l)||(e.x+=c,e.y+=y,e.value+=l))}}]),e}()},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t.exports=function(){function t(){n(this,t),this._enemy=null,this._radarTurnDirection=1,this._focusTime=120,this._searchTime=60,this._timer=0,this._enemyCount=0,this._turnOutput=this._radarTurnDirection}return r(t,[{key:"setEnemy",value:function(t){this._enemy=t}},{key:"setEnemyCount",value:function(t){this._enemyCount=t}},{key:"update",value:function(t,e,n,r){if(this._timer++,this._enemy&&r&&Math.distance(t,e,this._enemy.x,this._enemy.y)<100&&(this._enemy=this._focusTime+1),this._enemy)if(this._timer>this._focusTime&&this._timer<this._focusTime+this._searchTime)this._search();else if(this._timer>this._focusTime+this._searchTime)this._reset();else{var i=Math.deg.atan2(this._enemy.y-e,this._enemy.x-t),a=Math.deg.normalize(i-n);this._turnOutput=.2*a,this._radarTurnDirection=this._turnOutput>0?1:-1}else this._search()}},{key:"_search",value:function(){this._turnOutput=this._radarTurnDirection}},{key:"_reset",value:function(){this._timer=0,this._enemyCount<=1?this._focusTime+=60:this._focusTime=120,this._search()}},{key:"turnOutput",get:function(){return this._turnOutput}}]),t}()},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(6),o=n(7),u=n(8);t.exports=function(){function t(e){r(this,t),this._followStrategy=new a(e),this._ramStrategy=new o(e),this._searchStrategy=new u(e),this._strategy=this._followStrategy,this._debug={},this._enemy=null,this._ramTimer=0}return i(t,[{key:"setEnemy",value:function(t){this._enemy=t,this._strategy.setEnemy(t)}},{key:"update",value:function(t){this._ramTimer=Math.max(0,this._ramTimer-1),this._enemy&&this._enemy.energyDropRate>-.05&&this._enemy.age<5&&this._enemy.radarTime>200&&(this._ramTimer=700),this._enemy&&this._ramTimer>0?(this._strategy=this._ramStrategy,this._debug.strategy="ram"):this._enemy?(this._strategy=this._followStrategy,this._debug.strategy="ram"):(this._strategy=this._searchStrategy,this._debug.strategy="search"),this._strategy.update(t),this._debug.strategyDebug=this._strategy.debug,this._debug.radarTime=this._enemy?this._enemy.radarTime:null,this._debug.energyDropRate=this._enemy?this._enemy.energyDropRate:null,this._debug.ramTimer=this._ramTimer}},{key:"debug",get:function(){return this._debug}},{key:"throttleOutput",get:function(){return this._strategy.throttleOutput}},{key:"turnOutput",get:function(){return this._strategy.turnOutput}},{key:"boostOutput",get:function(){return this._strategy.boostOutput}}]),t}()},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t.exports=function(){function t(e){n(this,t),this._map=e,this._boostOutput=0,this._turnOutput=0,this._throttleOutput=0,this._enemy=null,this._debug={},this._targetDistance=250}return r(t,[{key:"setEnemy",value:function(t){this._enemy=t}},{key:"update",value:function(t){var e=t.x,n=t.y,r=t.angle,i=this._map.getForceVector(e,n);if(this._enemy){var a=Math.distance(e,n,this._enemy.x,this._enemy.y);this._enemy&&this._enemy.energyDropRate>-.05?this._targetDistance=100:this._targetDistance=Math.min(250,this._targetDistance+1);var o=this._targetDistance-a,u=this._targetDistance>a?-1:1,s=a?(this._enemy.x-e)/a:0,h=a?(this._enemy.y-n)/a:0;o*=o,s*=o*=1e-7*u,h*=o,o=Math.abs(o),i.x+=s,i.y+=h,i.value+=o,i.r=Math.distance(0,0,i.x,i.y),this._debug={targetDistance:this._targetDistance,distance:a,r:1e6*o}}i.r?(i.x=i.value*(i.x/i.r),i.y=i.value*(i.y/i.r)):(i.x=0,i.y=0);var l=Math.deg.atan2(i.y,i.x),c=1,y=Math.deg.normalize(l-r);y>90?(y-=180,c=-1):y<-90&&(y+=180,c=-1),this._turnOutput=.2*y,Math.abs(y)<90?(this._throttleOutput=c,this._boostOutput=1e3*i.r>1.3?1:0):(this._throttleOutput=0,this._boostOutput=0)}},{key:"debug",get:function(){return this._debug}},{key:"throttleOutput",get:function(){return this._throttleOutput}},{key:"turnOutput",get:function(){return this._turnOutput}},{key:"boostOutput",get:function(){return this._boostOutput}}]),t}()},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t.exports=function(){function t(e){n(this,t),this._map=e,this._boostOutput=0,this._turnOutput=0,this._throttleOutput=0,this._enemy=null,this._debug={},this._goBackTimer=0}return r(t,[{key:"setEnemy",value:function(t){this._enemy=t}},{key:"update",value:function(t){var e=t.x,n=t.y,r=t.angle,i=t.collisions.enemy;this._goBackTimer=Math.max(0,this._goBackTimer-1);var a=this._map.getForceVector(e,n),o=Number.MAX_VALUE;if(this._enemy){var u=Math.distance(e,n,this._enemy.x,this._enemy.y),s=u?(this._enemy.x-e)/u:0,h=u?(this._enemy.y-n)/u:0;u=u?1/u*u:0,s*=u*=10,h*=u,u=Math.abs(u),a.x+=s,a.y+=h,a.value+=u,a.r=Math.distance(0,0,a.x,a.y),o=u}a.r?(a.x=a.value*(a.x/a.r),a.y=a.value*(a.y/a.r)):(a.x=0,a.y=0);var l=Math.deg.atan2(a.y,a.x),c=1,y=Math.deg.normalize(l-r);y>90?(y-=180,c=-1):y<-90&&(y+=180,c=-1),i&&(this._goBackTimer=30),this._goBackTimer>0&&(c*=-1),this._turnOutput=.2*y,Math.abs(y)<90?this._throttleOutput=c:this._throttleOutput=0,this._boostOutput=o<100&&0==this._goBackTimer?1:0}},{key:"debug",get:function(){return this._debug}},{key:"throttleOutput",get:function(){return this._throttleOutput}},{key:"turnOutput",get:function(){return this._turnOutput}},{key:"boostOutput",get:function(){return this._boostOutput}}]),t}()},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t.exports=function(){function t(e){n(this,t),this._map=e,this._turnDirection=Math.random()<.5?1:-1,this._turnTimer=Math.round(Math.randomRange(0,30))}return r(t,[{key:"setEnemy",value:function(t){this._enemy=t}},{key:"update",value:function(t){(t.collisions.wall||t.collisions.enemy||t.collisions.ally)&&(this._turnTimer=Math.round(Math.randomRange(20,50))),this._turnTimer>0?(this._turnTimer--,this._throttleOutput=0,this._turnOutput=this._turnDirection):(this._throttleOutput=1,this._turnOutput=0),this._boostOutput=0}},{key:"debug",get:function(){return this._debug}},{key:"throttleOutput",get:function(){return this._throttleOutput}},{key:"turnOutput",get:function(){return this._turnOutput}},{key:"boostOutput",get:function(){return this._boostOutput}}]),t}()},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t.exports=function(){function t(){n(this,t),this._turnOutput=0,this._shootOutput=0,this._enemy=null,this._allies=[]}return r(t,[{key:"setEnemy",value:function(t){this._enemy=t}},{key:"setAllies",value:function(t){this._allies=t}},{key:"update",value:function(t){var e,n=t.x,r=t.y,i=t.angle,a=t.gun.angle,o=t.radar.angle,u=i+a;if(!this._enemy)return e=Math.deg.normalize(o-a),this._turnOutput=.2*e,void(this._shootOutput=0);var s,h,l=this._enemy.x,c=this._enemy.y,y=this._enemy.speed,_=this._enemy.angle*(Math.PI/180);s=0,h=1;for(var f=0;f<10&&Math.abs(h)>=1;f++)s+=h=Math.distance(n,r,l,c)/4-s,l=this._enemy.x+s*y*Math.cos(_),c=this._enemy.y+s*y*Math.sin(_);var m=Math.deg.atan2(c-r,l-n);e=Math.deg.normalize(m-u),this._turnOutput=.2*e;var p=Math.min(1,Math.max(.1,(10-this._enemy.age)/10));this._enemy&&this._enemy.energyDropRate>-.05&&(p=.1),this._aimingAtAlly(t)?this._shootOutput=0:Math.abs(e)<4+4*(1-p)?this._shootOutput=p:this._shootOutput=.1}},{key:"_aimingAtAlly",value:function(t){var e;e=this._enemy?Math.distance(t.x,t.y,this._enemy.x,this._enemy.y):Number.MAX_VALUE;var n,r,i;for(var a in this._allies)if((n=this._allies[a])&&(r=Math.deg.atan2(n.y-t.y,n.x-t.x),i=Math.deg.normalize(r-t.angle-t.gun.angle),Math.abs(i)<20))return Math.distance(t.x,t.y,n.x,n.y)-50<e;return!1}},{key:"turnOutput",get:function(){return this._turnOutput}},{key:"shootOutput",get:function(){return this._shootOutput}}]),t}()}]);'},s=0;for(o=0;o<e.trainingUnits&&t.pickFree();o++)(n=t.pickFree()).startProcessing(),(i=JsBattle.createAiDefinition()).fromCode(n.name,r.default,{braindump:n.genome.data}),i.disableSandbox(),e._simulation.addTank(i),e._units.push(n),s++;for(o=0;o<e.dummyUnits;o++)(i=JsBattle.createAiDefinition()).fromCode("dummy",a[e.dummyType]),i.disableSandbox(),e._simulation.addTank(i),s++;for(;s<=1;)(i=JsBattle.createAiDefinition()).fromCode("dummy",a.crawler),i.disableSandbox(),e._simulation.addTank(i),s++;e._simulation.start(),e._isRunning=!0}})))},t}();e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=function(){function t(t,e){this._score=0,this._completed=!1,this._inProgress=!1,this._name=t||"anonymous",this._genome=e||new r.default}return Object.defineProperty(t.prototype,"genome",{get:function(){return this._genome},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"completed",{get:function(){return this._completed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inProgress",{get:function(){return this._inProgress},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this._completed=!1,this._inProgress=!1,this._score=0},t.prototype.setScore=function(t){this._completed=!0,this._inProgress=!1,this._score=t},t.prototype.startProcessing=function(){this._completed=!1,this._inProgress=!0},t.prototype.toJSON=function(){return{name:this._name,genome:this._genome.toJSON(),score:this._score,completed:this._completed,inProgress:this._inProgress}},t.fromJSON=function(e){var n=new t;return n._name=e.name,n._genome=r.default.fromJSON(e.genome),n._score=e.score,n._completed=e.completed,n._inProgress=e.inProgress,n},t}();e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(10),i=n(11),o=n(13),a=function(){function t(t,e){var n=this;this._changeCallbacks=[],this._domContainer=document.getElementById(t),this._controls=new i.default,this._canvas=document.createElement("canvas"),this._canvas.width=900,this._canvas.height=600,this._domContainer.appendChild(this._canvas),this._domContainer.appendChild(this._controls.container),this._controls.preview.onclick=function(){window.location.replace("/#preview"),window.location.reload()},this._settings=new r.default(this._domContainer),this._import=new o.default(this._domContainer),this._controls.settings.onclick=function(){return n._settings.showPopup()},this._settings.onSave((function(){return n._changeCallbacks.forEach((function(t){return t()}))})),this._controls.import.onclick=function(){return n._import.showPopup()},this._controls.export.onclick=function(){return n.export()},this._controls.clear.onclick=function(){return n.clearPopulation()},this._population=e,setInterval((function(){n.refresh()}),50)}return Object.defineProperty(t.prototype,"settingsPopup",{get:function(){return this._settings},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"importPopup",{get:function(){return this._import},enumerable:!1,configurable:!0}),t.prototype.export=function(){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(this._population.toJSON()))),t.setAttribute("download","kaboom-gen"+this._population.generation+"-size"+this._population.size+".json"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)},t.prototype.clearPopulation=function(){confirm("Are you sure? This action will result in removing your population progress and starting with a new, random population from scratch")&&(this._population.reset(),this._changeCallbacks.forEach((function(t){return t()})))},t.prototype.refresh=function(){var t,e=0,n=0;for(t=0;t<this._population.size;t++)this._population.units[t].completed?e++:this._population.units[t].inProgress&&n++;var r=this._canvas.getContext("2d");r.fillStyle="#000",r.fillRect(0,0,900,600),r.fillStyle="#0f0",r.font="24px Courier",r.fillText("Population progress: "+(100*e/this._population.units.length).toFixed(1)+"% ("+e+"/"+this._population.units.length+")",10,30);var i=Math.round(860*e/this._population.units.length),o=Math.round(860*n/this._population.units.length),a=860-i-o;r.fillStyle="#0f0",r.fillRect(20,60,i,20),r.fillStyle="#0a0",r.fillRect(20+i,60,o,20),r.fillStyle="#030",r.fillRect(20+i+o,60,a,20),r.fillStyle="#0f0",r.fillText("Generation: "+this._population.generation,10,130),r.fillText("Diversity: "+this._population.diversity+"%",10,180),r.fillText("Scores: "+this._population.worstScore.toFixed(2)+" - "+this._population.bestScore.toFixed(2),10,330);var s=this._population.getUnitProcessingRate();r.fillText("Processing Rate: "+(s?s.toFixed(2):"???")+" units / minute",10,230);var u=this._population.scoreHistogram.reduce((function(t,e){return Math.max(t,e)}),1),l=860/this._population.scoreHistogram.length,c=this._population.scoreHistogram.map((function(t){return 120*t/u}));for(r.fillStyle="#0f0",t=0;t<this._population.scoreHistogram.length;t++)r.fillRect(20+t*l,480-c[t],l-1,c[t]);this._controls.preview.disabled=null==this._population.bestGenome},t.prototype.onChange=function(t){this._changeCallbacks.push(t)},t}();e.default=a},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e){var n=t.call(this,e,"settings")||this;return n._concurrency=1,n._simSpeed=1,n._trainingUnits=4,n._dummyUnits=0,n._dummyType="crawler",n._renderer="debug",n._mutation=.01,n._battleDuration=6e4,n._saveCallbacks=[],n._saveButton=document.getElementById("save-button"),n._saveButton.onclick=function(){return n.save()},document.getElementById("concurrency").onchange=function(t){var e=t.target;n._concurrency=Number(e.value)},n.concurrency=n._concurrency,document.getElementById("sim-time").onchange=function(t){var e=t.target;n._battleDuration=Number(e.value)},n.battleDuration=n._battleDuration,document.getElementById("sim-speed").onchange=function(t){var e=t.target;n._simSpeed=Number(e.value)},n.simSpeed=n._simSpeed,document.getElementById("units-dummy").onchange=function(t){var e=t.target;n._dummyUnits=Number(e.value)},n.dummyUnits=n._dummyUnits,document.getElementById("units-training").onchange=function(t){var e=t.target;n._trainingUnits=Number(e.value)},n.trainingUnits=n._trainingUnits,document.getElementById("dummy-type").onchange=function(t){var e=t.target;n._dummyType=e.value},n.dummyType=n._dummyType,document.getElementById("renderer").onchange=function(t){var e=t.target;n._renderer=e.value},n.renderer=n._renderer,document.getElementById("mutation").onchange=function(t){var e=t.target;n._mutation=Number(e.value)},n.mutation=n._mutation,n.load(),n}return i(e,t),Object.defineProperty(e.prototype,"concurrency",{get:function(){return this._concurrency},set:function(t){this._concurrency=t,document.getElementById("concurrency").value=t.toString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"battleDuration",{get:function(){return this._battleDuration},set:function(t){this._battleDuration=t,document.getElementById("sim-time").value=t.toString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"simSpeed",{get:function(){return this._simSpeed},set:function(t){this._simSpeed=t,document.getElementById("sim-speed").value=t.toString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dummyUnits",{get:function(){return this._dummyUnits},set:function(t){this._dummyUnits=t,document.getElementById("units-dummy").value=t.toString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainingUnits",{get:function(){return this._trainingUnits},set:function(t){this._trainingUnits=t,document.getElementById("units-training").value=t.toString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mutation",{get:function(){return this._mutation},set:function(t){this._mutation=t,document.getElementById("mutation").value=t.toString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dummyType",{get:function(){return this._dummyType},set:function(t){this._dummyType=t,document.getElementById("dummy-type").value=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderer",{get:function(){return this._renderer},set:function(t){this._renderer=t,document.getElementById("renderer").value=t},enumerable:!1,configurable:!0}),e.prototype.onSave=function(t){this._saveCallbacks.push(t)},e.prototype.load=function(){var t=localStorage.getItem("nn-sim-settings");if(t){var e=JSON.parse(t);void 0!==e.concurrency&&(this.concurrency=e.concurrency),void 0!==e.battleDuration&&(this.battleDuration=e.battleDuration),void 0!==e.simSpeed&&(this.simSpeed=e.simSpeed),void 0!==e.dummyUnits&&(this.dummyUnits=e.dummyUnits),void 0!==e.trainingUnits&&(this.trainingUnits=e.trainingUnits),void 0!==e.dummyType&&(this.dummyType=e.dummyType),void 0!==e.renderer&&(this.renderer=e.renderer),void 0!==e.mutation&&(this.mutation=e.mutation)}},e.prototype.save=function(){this._saveCallbacks.forEach((function(t){return t()})),this.closePopup();var t={concurrency:this._concurrency,battleDuration:this._battleDuration,simSpeed:this._simSpeed,dummyUnits:this._dummyUnits,trainingUnits:this._trainingUnits,dummyType:this.dummyType,renderer:this.renderer,mutation:this.mutation};localStorage.setItem("nn-sim-settings",JSON.stringify(t))},e}(n(4).default);e.default=o},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){var e=t.call(this)||this;return e._preview=e.createButton("preview","Preview"),e._export=e.createButton("export","Export"),e._import=e.createButton("import","Import"),e._clear=e.createButton("clear","Clear"),e._settings=e.createButton("settings","Settings"),e}return i(e,t),Object.defineProperty(e.prototype,"preview",{get:function(){return this._preview},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"settings",{get:function(){return this._settings},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"export",{get:function(){return this._export},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"import",{get:function(){return this._import},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clear",{get:function(){return this._clear},enumerable:!1,configurable:!0}),e}(n(12).default);e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this._buttons=new Map,this._container=document.createElement("div"),this._container.classList.add("controls")}return Object.defineProperty(t.prototype,"container",{get:function(){return this._container},enumerable:!1,configurable:!0}),t.prototype.createButton=function(t,e){if(this._buttons.has(t))throw new Error("Button '"+t+"' already exists");var n;return(n=document.createElement("button")).innerText=e,this.container.appendChild(n),this._buttons.set(t,n),n},t.prototype.getButton=function(t){if(!this._buttons.has(t))throw new Error("Button '"+t+"' does not exist");return this._buttons.get(t)},t}();e.default=r},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e){var n=t.call(this,e,"import")||this;return n._loadCallbacks=[],n._fileSelector=n.popupContainer.querySelector("#import-file"),n._fileSelector.addEventListener("change",(function(t){var e=t.target.files,r=new FileReader;r.addEventListener("load",(function(t){try{n.onFileLoad(t)}catch(t){n.closePopup(),alert(t.toString())}})),n._fileSelector.style.display="none",r.readAsText(e[0])})),n}return i(e,t),e.prototype.onFileLoad=function(t){var e=t.target.result,n=JSON.parse(e);this._loadCallbacks.forEach((function(t){return t(n)})),this.closePopup()},e.prototype.showPopup=function(){this._fileSelector.style.display="inline",this._fileSelector.value=null,t.prototype.showPopup.call(this)},e.prototype.onLoad=function(t){this._loadCallbacks.push(t)},e}(n(4).default);e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PreviewApp=void 0;var r=n(2),i=n(0),o=n(1),a=function(){function t(){var t=this;this._isRunning=!1,document.body.innerHTML="",this._population=new r.default,this._population.create(i.default.populationSize),this._population.load(i.default.populationName),this._backButton=document.createElement("button"),this._backButton.classList.add("back"),this._backButton.innerText="<< Go Back",document.body.appendChild(this._backButton),this._backButton.onclick=function(){window.location.replace("/#sim"),window.location.reload()},this._copyButton=document.createElement("button"),this._copyButton.classList.add("copy"),this._copyButton.innerText="Copy Script to the Clipboard",document.body.appendChild(this._copyButton),this._copyButton.onclick=function(){t._codeContainer.select(),document.execCommand("copy")},document.body.appendChild(document.createElement("br")),this._domContainer=document.createElement("div"),this._domContainer.style.width="450px",this._domContainer.style.display="inline-block",document.body.appendChild(this._domContainer),this.start()}return t.prototype.stop=function(){for(;this._domContainer.firstChild;)this._domContainer.removeChild(this._domContainer.lastChild);this._simulation&&(this._simulation.stop(),this._simulation=null),this._renderer&&(this._renderer.stop(),this._renderer.dispose(),this._renderer=null),this._canvas=null,this._isRunning=!1},t.prototype.start=function(){var t=this;this._isRunning&&this.stop(),this._canvas=document.createElement("canvas"),this._canvas.style.width="600px",this._canvas.style.height="400px",this._domContainer.appendChild(this._canvas),this._codeContainer=document.createElement("textarea"),this._domContainer.appendChild(this._codeContainer);var e=JSON.stringify(Array.from(new Uint8Array(this._population.bestGenome.data)));e="new Uint8Array("+e+").buffer",this._codeContainer.innerText=o.default.replace(/ai\.init\(settings, info\)/,"ai.init(settings, {initData: { braindump: "+e+"}})"),this._codeContainer.style.width="600px",this._codeContainer.style.height="400px",this._codeContainer.id="aiscript",this._renderer=JsBattle.createRenderer("debug"),this._renderer.init(this._canvas),this._renderer.loadAssets((function(){var e,n;for(t._simulation=JsBattle.createSimulation(t._renderer),t._simulation.setSpeed(1),t._simulation.init(900,600),t._simulation.onFinish((function(){t.stop(),t.start()})),n=0;n<3;n++)(e=JsBattle.createAiDefinition()).fromCode("kaboom",o.default,{braindump:t._population.bestGenome.data}),t._simulation.addTank(e),(e=JsBattle.createAiDefinition()).fromFile("crawler"),t._simulation.addTank(e);t._simulation.start(),t._isRunning=!0}))},t}();e.PreviewApp=a},function(t,e,n){var r=n(16),i=n(17);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[t.i,i,""]]);var o={insert:"head",singleton:!1};r(i,o);t.exports=i.locals||{}},function(t,e,n){"use strict";var r,i=function(){return void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r},o=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),a=[];function s(t){for(var e=-1,n=0;n<a.length;n++)if(a[n].identifier===t){e=n;break}return e}function u(t,e){for(var n={},r=[],i=0;i<t.length;i++){var o=t[i],u=e.base?o[0]+e.base:o[0],l=n[u]||0,c="".concat(u," ").concat(l);n[u]=l+1;var p=s(c),h={css:o[1],media:o[2],sourceMap:o[3]};-1!==p?(a[p].references++,a[p].updater(h)):a.push({identifier:c,updater:y(h,e),references:1}),r.push(c)}return r}function l(t){var e=document.createElement("style"),r=t.attributes||{};if(void 0===r.nonce){var i=n.nc;i&&(r.nonce=i)}if(Object.keys(r).forEach((function(t){e.setAttribute(t,r[t])})),"function"==typeof t.insert)t.insert(e);else{var a=o(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var c,p=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function h(t,e,n,r){var i=n?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(t.styleSheet)t.styleSheet.cssText=p(e,i);else{var o=document.createTextNode(i),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(o,a[e]):t.appendChild(o)}}function d(t,e,n){var r=n.css,i=n.media,o=n.sourceMap;if(i?t.setAttribute("media",i):t.removeAttribute("media"),o&&btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}var f=null,m=0;function y(t,e){var n,r,i;if(e.singleton){var o=m++;n=f||(f=l(e)),r=h.bind(null,n,o,!1),i=h.bind(null,n,o,!0)}else n=l(e),r=d.bind(null,n,e),i=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else i()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=i());var n=u(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var r=0;r<n.length;r++){var i=s(n[r]);a[i].references--}for(var o=u(t,e),l=0;l<n.length;l++){var c=s(n[l]);0===a[c].references&&(a[c].updater(),a.splice(c,1))}n=o}}}},function(t,e,n){(e=n(18)(!1)).push([t.i,"footer{font-family:Courier;font-size:.8em;color:lime;margin:1em;text-align:center}footer a{color:#ff0;font-weight:bold}#aiscript{background-color:#000;color:lime;border-color:#050;margin-top:1em}button.back,button.copy{font-family:Courier;margin:1em;padding:1em;color:lime;border:1px lime solid;cursor:pointer;background-color:#000;outline:0}#summary{position:relative;width:450px;display:inline-block}#summary canvas{width:100%;height:100%}#summary .controls{position:absolute;text-align:left;bottom:0;left:0;padding:.2em;margin:0;height:3em;width:calc(100% - 0.4em)}#summary .controls button{font-size:.7em;font-family:Courier;padding:auto;height:3em;color:lime;border:1px lime solid;cursor:pointer;background-color:#000;outline:0;margin:0 .2em;width:calc(20% - 0.4em)}#summary .controls button:disabled{color:#080;border-color:#080;background-color:#020;cursor:not-allowed}#summary .controls button:active{color:#000;background-color:lime}#summary #settings{width:70%;height:90%;margin:2% 15%}#summary #import{width:50%;height:50%;margin:10% 25%}#summary .popup{font-family:Courier;position:fixed;top:0;left:0;background-color:#000;border:3px lime solid;color:lime}#summary .popup button{font-family:Courier;background-color:lime;color:#000;border:none;outline:0;cursor:pointer;font-size:1.5em}#summary .popup h1{font-family:Courier;background-color:lime;color:#000;text-align:left;padding:.2em .5em;margin-top:0}#summary .popup h1 .close-button{float:right;font-size:1em;cursor:pointer}#summary .popup table{font-family:Courier;width:90%;margin:2em 5%}#summary .popup table td{width:50%;padding:.5em;border:1px solid lime;text-align:left}#summary .popup table input,#summary .popup table select{font-family:Courier;width:100%;color:#000;background-color:lime}",""]),t.exports=e},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",r=t[3];if(!r)return n;if(e&&"function"==typeof btoa){var i=(a=r,s=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),u="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(u," */")),o=r.sources.map((function(t){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(t," */")}));return[n].concat(o).concat([i]).join("\n")}var a,s,u;return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,r){"string"==typeof t&&(t=[[null,t,""]]);var i={};if(r)for(var o=0;o<this.length;o++){var a=this[o][0];null!=a&&(i[a]=!0)}for(var s=0;s<t.length;s++){var u=[].concat(t[s]);r&&i[u[0]]||(n&&(u[2]?u[2]="".concat(n," and ").concat(u[2]):u[2]=n),e.push(u))}},e}}]);